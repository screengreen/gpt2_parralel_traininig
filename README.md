# üß† GPT‚ÄëFrom‚ÄëScratch

**A minimal yet scalable GPT implementation in PyTorch 2.x, featuring modern training tricks and first‚Äëclass multi‚ÄëGPU support.**

---

## üó∫Ô∏è –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
2. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–¥–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∫–æ–¥–∞)
4. [–û–±—É—á–µ–Ω–∏–µ](#-–æ–±—É—á–µ–Ω–∏–µ)
5. [–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞](#-–æ—Ü–µ–Ω–∫–∞-–∫–∞—á–µ—Å—Ç–≤–∞)
6. [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞](#-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-—Ç–µ–∫—Å—Ç–∞)
7. [–ß–µ–∫–ø–æ–∏–Ω—Ç—ã](#-—á–µ–∫–ø–æ–∏–Ω—Ç—ã)
8. [–ê–≤—Ç–æ—Ä](#-–∞–≤—Ç–æ—Ä)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
$ git clone https://github.com/yourname/gpt-from-scratch.git && cd gpt-from-scratch

# 2. –°–æ–∑–¥–∞—ë–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —Å—Ç–∞–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
$ python -m venv .venv && source .venv/bin/activate
$ pip install -r requirements.txt

# 3. –°–∫–∞—á–∏–≤–∞–µ–º FineWeb¬†(–∏–ª–∏ –≤–∞—à –¥–∞—Ç–∞—Å–µ—Ç) –≤ /data/fineweb
#    –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. —Ä–∞–∑–¥–µ–ª ¬´–î–∞—Ç–∞—Å–µ—Ç¬ª –Ω–∏–∂–µ.

# 4. –û–¥–Ω–æ–≥–ø—É‚Äë–∑–∞–ø—É—Å–∫¬†(–ø—Ä–∏–º–µ—Ä)
$ python train.py

# 5. –ú–Ω–æ–≥–æ–≥–ø—É¬†(–ø—Ä–∏–º–µ—Ä –Ω–∞ 8¬†GPU A100)
$ torchrun \
  --nnodes 1 --nproc_per_node 8 \
  --master_port 29500 train.py
```

> **üí° –°–æ–≤–µ—Ç:** –î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–º–µ—à–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –¥—Ä–∞–π–≤–µ—Ä–æ–≤ NVIDIA –∏ CUDA¬†‚â•¬†12.2.

---

## üß© –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –°–æ—Ñ—Ç/–∂–µ–ª–µ–∑–æ | –ú–∏–Ω–∏–º—É–º             | –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ   |
| ----------- | ------------------- | --------------- |
| Python      | 3.10                | 3.11            |
| PyTorch     | 2.2                 | 2.3‚Äënightly     |
| GPU         | 1√ó¬†RTX¬†3060¬†(12¬†GB) | 8√ó¬†A100¬†(80¬†GB) |
| CUDA        | 11.8                | 12.3            |

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Python‚Äë–ø–∞–∫–µ—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `requirements.txt`.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

```
train.py          <-- –≤–µ—Å—å –∫–æ–¥ –æ–±—É—á–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ GPT            <-- –∫–ª–∞—Å—Å –º–æ–¥–µ–ª–∏ (Embedding ‚ûú n¬†√ó¬†Block ‚ûú Ln ‚ûú Head)
‚îÇ  ‚îú‚îÄ MultiheadScaledAttention
‚îÇ  ‚îú‚îÄ GPTFeedForward
‚îÇ  ‚îî‚îÄ GPTblock
‚îÇ
‚îú‚îÄ DataLoaderLite <-- –ø–æ—Ç–æ–∫–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ FineWeb‚Äë—à–∞—Ä–¥–æ–≤
‚îî‚îÄ utils          <-- LR‚Äësched, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, eval
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* **Weight tying** –º–µ–∂–¥—É `Embedding` –∏ `gpt_head`.
* **–ö–æ—Å–∏–Ω—É—Å–Ω—ã–π** –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ LR + –ª–∏–Ω–µ–π–Ω—ã–π ¬´—Ç—ë–ø–ª—ã–π —Å—Ç–∞—Ä—Ç¬ª.
* **Mixed precision** (`torch.autocast`, bfloat16).
* **Gradient clipping** –ø–µ—Ä–µ–¥ `optimizer.step()`.
* **–ß–µ–∫–ø–æ–∏–Ω—Ç—ã**: `state_dict`, –∫–æ–Ω—Ñ–∏–≥, step; —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–æ–æ–±—É—á–∫–æ–π.

---

## ‚öôÔ∏è –û–±—É—á–µ–Ω–∏–µ

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `train.py` (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `GPTConfig`). –û—Å–Ω–æ–≤–Ω—ã–µ:

| –ü–∞—Ä–∞–º–µ—Ç—Ä           | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
| ------------------ | --------------------- | --------------------------------------------- |
| `context_size`     | 1024                  | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞                  |
| `emb_size`         | 768                   | –†–∞–∑–º–µ—Ä —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è                          |
| `n_heads`          | 12                    | –ß–∏—Å–ª–æ –≥–æ–ª–æ–≤ –≤ Multi‚ÄëHead Attention            |
| `n_blocks`         | 12                    | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä‚Äë–±–ª–æ–∫–æ–≤                 |
| `total_batch_size` | 524‚ÄØ288 —Ç–æ–∫–µ–Ω–æ–≤       | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (–≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –∞–∫–∫—É–º.) |

–ò–∑–º–µ–Ω–∏—Ç–µ –∏—Ö, —á—Ç–æ–±—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –∏–ª–∏ —É—Å–∫–æ—Ä–∏—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç.

### Distributed Data Parallel

DDP –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `RANK` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

```bash
# –ø—Ä–∏–º–µ—Ä –¥–ª—è 4¬†GPU
$ torchrun --nproc_per_node 4 train.py
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ FineWeb –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ–∞–π–ª–æ–≤; –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤–∏–¥–∏—Ç —Å–≤–æ–π –Ω–∞–±–æ—Ä –ø—Ä–∏–º–µ—Ä–æ–≤ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤.

---

## üìä –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

* **Validation loss**¬†‚Äî –∫–∞–∂–¥—ã–µ 250¬†—à–∞–≥–æ–≤.
* **HellaSwag accuracy**¬†‚Äî –ø–æ –∑–∞–ø—Ä–æ—Å—É, –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏.

–õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ `log/log.txt` –∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.

---

## ‚úçÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞

–§—É–Ω–∫—Ü–∏—è `get_generation()` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 4¬†–æ–±—Ä–∞–∑—Ü–∞ –¥–ª–∏–Ω–æ–π 32¬†—Ç–æ–∫–µ–Ω–∞ —Å¬†Top‚ÄëK¬†=¬†50 –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–∏–¥–æ–º:

```python
rank 0 sample 0: Hello, I'm a language model, ...
```

–ò–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–æ–º–ø—Ç –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ–º–ø–ª–∏–Ω–≥–∞ –ø–æ –≤–∫—É—Å—É.

---

## üíæ –ß–µ–∫–ø–æ–∏–Ω—Ç—ã

* –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `log/` –∫–∞–∂–¥—ã–µ 7000¬†—à–∞–≥–æ–≤ –∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±—É—á–µ–Ω–∏—è.
* –°–æ–¥–µ—Ä–∂–∞—Ç –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏, –∫–æ–Ω—Ñ–∏–≥ –∏ –Ω–æ–º–µ—Ä —à–∞–≥–∞.
* –î–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è –ø–æ–º–µ—Å—Ç–∏—Ç–µ –Ω—É–∂–Ω—ã–π `.pt`‚Äë—Ñ–∞–π–ª –≤ `log/` –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏.

---

## üôå –ö–∞–∫ –≤–Ω–µ—Å—Ç–∏ –≤–∫–ª–∞–¥

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É `feature/<—Ç–µ–º–∞>`
2. –ö–æ–º–º–∏—Ç—ã¬†‚Äî –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, —Å–ª–µ–¥—É–π—Ç–µ Conventional Commits (`feat: ...`, `fix: ...`).
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `pytest` –∏ `flake8` –ø–µ—Ä–µ–¥ PR.
4. –û–ø–∏—Å–∞–Ω–∏–µ –≤¬†PR: —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ, –ø–æ—á–µ–º—É, —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏—è/—Ç–∏–∫–µ—Ç—ã.

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∫–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã —Ç–æ–∂–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!*

---

## üë§ –ê–≤—Ç–æ—Ä

| –ò–º—è             | –†–æ–ª—å                           | –ö–æ–Ω—Ç–∞–∫—Ç—ã                                                                                  |
| --------------- | ------------------------------ | ----------------------------------------------------------------------------------------- |
| **–ê–¥—Ä–µ–π –°—É—Ö–æ–≤** | üíª¬†—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, üìù¬†–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | [@telegram](https://t.me/suhowandrew) ¬∑ [suhowandrew@gmail.com](mailto:suhowandrew@gmail.com) |



